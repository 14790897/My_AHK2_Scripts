name: Build and Release

on:
  push:
    tags:
      - 'v*'  # è§¦å‘æ¡ä»¶ï¼šæ¨é€ä»¥ v å¼€å¤´çš„æ ‡ç­¾ï¼Œå¦‚ v1.0.0
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: windows-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Compile WindowIMEMemory
        uses: Banaanae/Action-Ahk2Exe@v1.0.3
        with:
          in: WindowIMEMemory.ahk
          out: WindowIMEMemory.exe
      
    #   - name: Compile AutoLanguage
    #     uses: Banaanae/Action-Ahk2Exe@v1.0.3
    #     with:
    #       in: AutoLanguage.ahk
    #       out: AutoLanguage.exe
    #     continue-on-error: true
      
      - name: Create source archive
        run: |
          Compress-Archive -Path "*.ahk", "*.md", "license" -DestinationPath "Source-${{ github.ref_name }}.zip" -Force
        shell: pwsh
      
      - name: Create Release
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          name: Release ${{ github.ref_name }}
          body: |
            ## ğŸ‰ ${{ github.ref_name }} Release
            
            ### ğŸ“¦ åŒ…å«å†…å®¹
            - WindowIMEMemory.exe - çª—å£è¾“å…¥æ³•è®°å¿†å·¥å…·
            - Source-${{ github.ref_name }}.zip - æºä»£ç å‹ç¼©åŒ…
            
            ### ğŸ“ ä½¿ç”¨è¯´æ˜
            
            **WindowIMEMemory**ï¼š
            - åŒå‡» `WindowIMEMemory.exe` è¿è¡Œ
            - å³é”®æ‰˜ç›˜å›¾æ ‡å¯ä»¥è®¾ç½®å¼€æœºè‡ªå¯åŠ¨
            - è‡ªåŠ¨è®°å¿†æ¯ä¸ªåº”ç”¨çš„è¾“å…¥æ³•çŠ¶æ€
            
            ### ğŸ“– å®Œæ•´æ–‡æ¡£
            è¯·æŸ¥çœ‹ [README.md](https://github.com/${{ github.repository }}/blob/main/README.md)
            
            ### ğŸ”§ ç³»ç»Ÿè¦æ±‚
            - Windows 10/11
            - æ— éœ€å®‰è£… AutoHotkeyï¼ˆç‹¬ç«‹è¿è¡Œï¼‰
          draft: false
          prerelease: false
          files: |
            WindowIMEMemory.exe
            Source-${{ github.ref_name }}.zip
